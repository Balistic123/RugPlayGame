import{c as K,h as ia,a,b as na,f as d,g as va,t as E,s as R,e as ca}from"../chunks/BiLdCT7w.js";import{p as pa,b as T,f as ua,h as _a,i as v,a as ma,$ as fa,e as i,c as s,n as c,r as o,s as t,g as e,t as Q,d as X}from"../chunks/Dc9Cd6uL.js";import{i as V}from"../chunks/4JrI1xkN.js";import{e as Ce,i as Le}from"../chunks/DT6MbhOo.js";import{c as ie}from"../chunks/DKQvO5e2.js";import{B as $a}from"../chunks/PVG7Em25.js";import{I as Pe}from"../chunks/5J9eaWb4.js";import{L as ce}from"../chunks/Ct87CVwI.js";import{S as xa,a as ga,b as ha,c as ya,R as ba}from"../chunks/BZ8NTllV.js";import{C as Fe}from"../chunks/BE8a_9Ge.js";import{C as Ie}from"../chunks/D0g6TdLa.js";import{C as Oe}from"../chunks/CTo_Vl_F.js";import{f as Be,g as wa}from"../chunks/aor5dgAF.js";import{C as Me}from"../chunks/b_f0gCBc.js";import{C as Ne}from"../chunks/jS9pjJ83.js";import{A as Ca,a as Pa}from"../chunks/pD04GNng.js";import{B as Aa}from"../chunks/BvtTpaCk.js";import{S as pe}from"../chunks/DZFQxItp.js";import{U as Sa}from"../chunks/CTHXnj9k.js";import{T as qe,C as Ua}from"../chunks/DpU7WkdO.js";import{P as ze}from"../chunks/BiUxj-BE.js";import{L as Da}from"../chunks/khItcEfd.js";import{C as ka}from"../chunks/HRCXpe-l.js";import{U as Ea}from"../chunks/Bu7XxLTn.js";import{C as Ae}from"../chunks/D2mbqurB.js";var Ra=d('<meta name="robots" content="noindex, nofollow"/>'),Ta=d(`<div class="flex h-screen items-center justify-center"><div class="text-center"><h1 class="text-2xl font-bold">Access Denied</h1> <p class="text-muted-foreground">You don't have permission to access this page.</p></div></div>`),ja=d("<!> Create",1),La=d("<!> <!>",1),Fa=d("<!> <!>",1),Ia=d('<span class="font-semibold"> </span>'),Oa=d(" <!>",1),Ba=d("<!> <!>",1),Ma=d("<!> Creating...",1),Na=d("<!> Create Code",1),qa=d('<form class="space-y-3"><div class="grid gap-3 sm:grid-cols-2"><div class="space-y-1"><!> <!></div> <div class="space-y-1"><!> <!></div></div> <div class="grid gap-3 sm:grid-cols-2"><div class="space-y-1"><!> <!></div> <div class="space-y-1"><!> <!></div></div> <!> <!></form>'),za=d("<!> <!>",1),Ha=d("<!> <!>",1),Ja=d('<div class="space-y-2 rounded-lg border p-3"><div class="flex items-center justify-between"><!> <!></div> <div class="grid grid-cols-2 gap-2"><!> <!></div></div>'),Va=d('<div class="text-muted-foreground py-6 text-center"><!> <p class="text-sm">No codes created yet.</p></div>'),Wa=d('<div class="flex items-center gap-1"><!> <span> </span></div>'),Ya=d('<div class="flex items-center gap-1"><!> <span>No expiry</span></div>'),Ga=d('<div class="space-y-2 rounded-lg border p-3"><div class="flex items-center justify-between"><code class="bg-muted rounded px-2 py-1 font-mono text-sm font-semibold"> </code> <!></div> <div class="grid grid-cols-2 gap-3 text-xs"><span> </span> <div class="flex items-center gap-1"><!> <span> </span></div> <div class="flex items-center gap-1"><!> <span> </span></div> <!></div></div>'),Ka=d('<div class="space-y-3"><!></div>'),Qa=d("<!> <!>",1),Xa=d('<div class="container mx-auto space-y-4 p-4"><div class="flex items-center gap-2"><!> <h1 class="text-2xl font-bold">Promo Codes</h1></div> <div class="grid gap-4 lg:grid-cols-2"><!> <!></div></div>');function Pr(He,Je){pa(Je,!0);const[Ve,We]=na(),ue=()=>va(Sa,"$USER_DATA",Ve);let Z=T(""),I=T(""),re=T(""),ee=T(""),O=T(!1),W=T(!1),_e=T(""),ne=T(!1);const Se=[{value:"1h",label:"1 Hour"},{value:"1d",label:"1 Day"},{value:"3d",label:"3 Days"},{value:"7d",label:"7 Days"},{value:"30d",label:"30 Days"}];let Ye=X(()=>{var r;return((r=Se.find(g=>g.value===e(ee)))==null?void 0:r.label)||"Select expiration"}),me=T(ua([])),Ue=T(!0);async function De(){try{const r=await fetch("/api/admin/promo");if(r.ok){const g=await r.json();i(me,g.codes,!0)}else console.error("Failed to load promo codes:",r.status,r.statusText)}catch(r){console.error("Failed to load promo codes:",r)}finally{i(Ue,!1)}}let Ge=X(()=>e(Z).trim()&&e(I));async function Ke(){if(!(!e(Z).trim()||!e(I))){i(O,!0),i(ne,!1);try{const r=await fetch("/api/admin/promo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e(Z).trim().toUpperCase(),rewardAmount:parseFloat(e(I)),maxUses:e(re)?parseInt(e(re)):null,expiresAt:e(ee)?wa(e(ee)):null})}),g=await r.json();i(W,r.ok,!0),i(_e,r.ok?"Promo code created successfully!":g.error||"Failed to create promo code",!0),i(ne,!0),r.ok&&(i(Z,""),i(I,""),i(re,""),i(ee,""),await De())}catch(r){console.log(r),i(W,!1),i(_e,"Failed to create promo code. Please try again."),i(ne,!0)}finally{i(O,!1)}}}function Qe(r){r.preventDefault(),Ke()}_a(()=>{var r;(r=ue())!=null&&r.isAdmin&&De()});var ke=K();ia(r=>{var g=Ra();fa.title="Promo Codes - Admin | Rugplay",a(r,g)});var Xe=v(ke);{var Ze=r=>{var g=Ta();a(r,g)},ea=r=>{var g=Xa(),fe=s(g),aa=s(fe);qe(aa,{class:"h-5 w-5"}),c(2),o(fe);var Ee=t(fe,2),Re=s(Ee);Fe(Re,{children:($e,ta)=>{var te=za(),se=v(te);Me(se,{class:"pb-3",children:(Y,ge)=>{var $=La(),A=v($);Ne(A,{class:"flex items-center gap-2 text-lg",children:(y,b)=>{var p=ja(),B=v(p);ze(B,{class:"h-4 w-4"}),c(),a(y,p)},$$slots:{default:!0}});var j=t(A,2);Oe(j,{class:"text-sm",children:(y,b)=>{c();var p=E("Draft a new promo code for users to redeem.");a(y,p)},$$slots:{default:!0}}),a(Y,$)},$$slots:{default:!0}});var xe=t(se,2);Ie(xe,{children:(Y,ge)=>{var $=qa(),A=s($),j=s(A),y=s(j);ce(y,{for:"code",class:"text-sm",children:(l,w)=>{c();var n=E("Code *");a(l,n)},$$slots:{default:!0}});var b=t(y,2);Pe(b,{id:"code",placeholder:"WELCOME100",get disabled(){return e(O)},class:"h-8 uppercase",style:"text-transform: uppercase;",required:!0,get value(){return e(Z)},set value(l){i(Z,l,!0)}}),o(j);var p=t(j,2),B=s(p);ce(B,{for:"reward",class:"text-sm",children:(l,w)=>{c();var n=E("Reward Amount *");a(l,n)},$$slots:{default:!0}});var oe=t(B,2);Pe(oe,{id:"reward",type:"number",step:"0.01",min:"0",placeholder:"100.00",get disabled(){return e(O)},class:"h-8",required:!0,get value(){return e(I)},set value(l){i(I,l,!0)}}),o(p),o(A);var S=t(A,2),x=s(S),U=s(x);ce(U,{for:"maxUses",class:"text-sm",children:(l,w)=>{c();var n=E("Max Uses");a(l,n)},$$slots:{default:!0}});var M=t(U,2);Pe(M,{id:"maxUses",type:"number",min:"1",placeholder:"Unlimited",get disabled(){return e(O)},class:"h-8",get value(){return e(re)},set value(l){i(re,l,!0)}}),o(x);var _=t(x,2),L=s(_);ce(L,{for:"expires",class:"text-sm",children:(l,w)=>{c();var n=E("Expires In");a(l,n)},$$slots:{default:!0}});var N=t(L,2);ie(N,()=>ba,(l,w)=>{w(l,{type:"single",get disabled(){return e(O)},get value(){return e(ee)},set value(n){i(ee,n,!0)},children:(n,z)=>{var H=Fa(),D=v(H);ie(D,()=>xa,(m,C)=>{C(m,{class:"h-8 w-full",children:(J,le)=>{c();var u=E();Q(()=>R(u,e(Ye))),a(J,u)},$$slots:{default:!0}})});var h=t(D,2);ie(h,()=>ga,(m,C)=>{C(m,{children:(J,le)=>{var u=K(),ve=v(u);ie(ve,()=>ha,(ae,f)=>{f(ae,{children:(P,k)=>{var F=K(),G=v(F);Ce(G,17,()=>Se,Le,(de,we)=>{var Te=K(),sa=v(Te);ie(sa,()=>ya,(oa,la)=>{la(oa,{get value(){return e(we).value},get label(){return e(we).label},children:(da,Za)=>{c();var je=E();Q(()=>R(je,e(we).label)),a(da,je)},$$slots:{default:!0}})}),a(de,Te)}),a(P,F)},$$slots:{default:!0}})}),a(J,u)},$$slots:{default:!0}})}),a(n,H)},$$slots:{default:!0}})}),o(_),o(S);var q=t(S,2);{var he=l=>{const w=X(()=>e(W)?"default":"destructive"),n=X(()=>e(W)?"text-success":"");Ca(l,{get variant(){return e(w)},get class(){return e(n)},children:(z,H)=>{var D=Ba(),h=v(D);{var m=u=>{ka(u,{class:"h-4 w-4 text-green-600"})},C=u=>{Ua(u,{class:"h-4 w-4"})};V(h,u=>{e(W)?u(m):u(C,!1)})}var J=t(h,2);const le=X(()=>e(W)?"text-green-800 dark:text-green-200":"");Pa(J,{get class(){return e(le)},children:(u,ve)=>{c();var ae=Oa(),f=v(ae),P=t(f);{var k=F=>{var G=Ia(),de=s(G);o(G),Q(()=>R(de,`(+$${e(I)??""} reward)`)),a(F,G)};V(P,F=>{e(W)&&e(I)&&F(k)})}Q(()=>R(f,`${e(_e)??""} `)),a(u,ae)},$$slots:{default:!0}}),a(z,D)},$$slots:{default:!0}})};V(q,l=>{e(ne)&&l(he)})}var ye=t(q,2);const be=X(()=>!e(Ge)||e(O));$a(ye,{type:"submit",get disabled(){return e(be)},class:"h-8 w-full",size:"sm",children:(l,w)=>{var n=K(),z=v(n);{var H=h=>{var m=Ma(),C=v(m);Da(C,{class:"h-3 w-3 animate-spin"}),c(),a(h,m)},D=h=>{var m=Na(),C=v(m);ze(C,{class:"h-3 w-3"}),c(),a(h,m)};V(z,h=>{e(O)?h(H):h(D,!1)})}a(l,n)},$$slots:{default:!0}}),o($),ca("submit",$,Qe),a(Y,$)},$$slots:{default:!0}}),a($e,te)},$$slots:{default:!0}});var ra=t(Re,2);Fe(ra,{children:($e,ta)=>{var te=Qa(),se=v(te);Me(se,{class:"pb-3",children:(Y,ge)=>{var $=Ha(),A=v($);Ne(A,{class:"text-lg",children:(y,b)=>{c();var p=E("Active");a(y,p)},$$slots:{default:!0}});var j=t(A,2);Oe(j,{class:"text-sm",children:(y,b)=>{c();var p=E("Manage existing promo codes.");a(y,p)},$$slots:{default:!0}}),a(Y,$)},$$slots:{default:!0}});var xe=t(se,2);Ie(xe,{children:(Y,ge)=>{var $=Ka(),A=s($);{var j=b=>{var p=K(),B=v(p);Ce(B,16,()=>Array(3),Le,(oe,S)=>{var x=Ja(),U=s(x),M=s(U);pe(M,{class:"h-4 w-20"});var _=t(M,2);pe(_,{class:"h-5 w-14"}),o(U);var L=t(U,2),N=s(L);pe(N,{class:"h-3 w-16"});var q=t(N,2);pe(q,{class:"h-3 w-12"}),o(L),o(x),a(oe,x)}),a(b,p)},y=(b,p)=>{{var B=S=>{var x=Va(),U=s(x);qe(U,{class:"mx-auto mb-2 h-8 w-8 opacity-50"}),c(2),o(x),a(S,x)},oe=S=>{var x=K(),U=v(x);Ce(U,17,()=>e(me),M=>M.id,(M,_)=>{var L=Ga(),N=s(L),q=s(N),he=s(q,!0);o(q);var ye=t(q,2);const be=X(()=>e(_).isActive?"default":"secondary");Aa(ye,{get variant(){return e(be)},class:"text-xs",children:(f,P)=>{c();var k=E();Q(()=>R(k,e(_).isActive?"Active":"Inactive")),a(f,k)},$$slots:{default:!0}}),o(N);var l=t(N,2),w=s(l),n=s(w);o(w);var z=t(w,2),H=s(z);Ea(H,{class:"h-3 w-3"});var D=t(H,2),h=s(D);o(D),o(z);var m=t(z,2),C=s(m);Ae(C,{class:"h-3 w-3"});var J=t(C,2),le=s(J,!0);o(J),o(m);var u=t(m,2);{var ve=f=>{var P=Wa(),k=s(P);Ae(k,{class:"h-3 w-3"});var F=t(k,2),G=s(F);o(F),o(P),Q(de=>R(G,`Exp: ${de??""}`),[()=>Be(e(_).expiresAt)]),a(f,P)},ae=f=>{var P=Ya(),k=s(P);Ae(k,{class:"h-3 w-3"}),c(2),o(P),a(f,P)};V(u,f=>{e(_).expiresAt?f(ve):f(ae,!1)})}o(l),o(L),Q(f=>{R(he,e(_).code),R(n,`$${e(_).rewardAmount??""}`),R(h,`${(e(_).usedCount||0)??""}${e(_).maxUses?`/${e(_).maxUses}`:""}`),R(le,f)},[()=>Be(e(_).createdAt)]),a(M,L)}),a(S,x)};V(b,S=>{e(me).length===0?S(B):S(oe,!1)},p)}};V(A,b=>{e(Ue)?b(j):b(y,!1)})}o($),a(Y,$)},$$slots:{default:!0}}),a($e,te)},$$slots:{default:!0}}),o(Ee),o(g),a(r,g)};V(Xe,r=>{!ue()||!ue().isAdmin?r(Ze):r(ea,!1)})}a(He,ke),ma(),We()}export{Pr as component};
