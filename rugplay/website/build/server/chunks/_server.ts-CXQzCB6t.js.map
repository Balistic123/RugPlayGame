{"version":3,"file":"_server.ts-CXQzCB6t.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/proxy/s3/_...path_/_server.ts.js"],"sourcesContent":["import { a as PUBLIC_B2_ENDPOINT, b as PUBLIC_B2_BUCKET } from \"../../../../../../chunks/public.js\";\nimport { e as error } from \"../../../../../../chunks/index.js\";\nasync function GET({ params, request }) {\n  const path = params.path;\n  if (!path) {\n    throw error(400, \"Path is required\");\n  }\n  try {\n    const s3Url = `${PUBLIC_B2_ENDPOINT}/${PUBLIC_B2_BUCKET}/${path}`;\n    const response = await fetch(s3Url);\n    if (!response.ok) {\n      throw error(response.status, \"Failed to fetch from S3\");\n    }\n    const contentType = response.headers.get(\"content-type\") || \"application/octet-stream\";\n    const buffer = await response.arrayBuffer();\n    let cacheControl;\n    if (path.includes(\"/coin/\") || path.includes(\"coin-icon\")) {\n      cacheControl = \"public, max-age=31536000, immutable\";\n    } else if (path.includes(\"/avatars/\") || path.includes(\"profile-\") || path.includes(\"avatar\")) {\n      cacheControl = \"public, max-age=60\";\n    } else {\n      cacheControl = \"public, max-age=86400\";\n    }\n    return new Response(buffer, {\n      headers: {\n        \"Content-Type\": contentType,\n        \"Cache-Control\": cacheControl,\n        \"Access-Control-Allow-Origin\": \"*\",\n        \"Access-Control-Allow-Methods\": \"GET\",\n        \"Access-Control-Allow-Headers\": \"Content-Type\"\n      }\n    });\n  } catch (e) {\n    console.error(\"Proxy error:\", e);\n    throw error(500, \"Failed to proxy S3 request\");\n  }\n}\nexport {\n  GET\n};\n"],"names":[],"mappings":";;;AAEA,eAAe,GAAG,CAAC,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE;AACxC,EAAE,MAAM,IAAI,GAAG,MAAM,CAAC,IAAI;AAC1B,EAAE,IAAI,CAAC,IAAI,EAAE;AACb,IAAI,MAAM,KAAK,CAAC,GAAG,EAAE,kBAAkB,CAAC;AACxC;AACA,EAAE,IAAI;AACN,IAAI,MAAM,KAAK,GAAG,CAAC,EAAE,kBAAkB,CAAC,CAAC,EAAE,gBAAgB,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;AACrE,IAAI,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,KAAK,CAAC;AACvC,IAAI,IAAI,CAAC,QAAQ,CAAC,EAAE,EAAE;AACtB,MAAM,MAAM,KAAK,CAAC,QAAQ,CAAC,MAAM,EAAE,yBAAyB,CAAC;AAC7D;AACA,IAAI,MAAM,WAAW,GAAG,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,cAAc,CAAC,IAAI,0BAA0B;AAC1F,IAAI,MAAM,MAAM,GAAG,MAAM,QAAQ,CAAC,WAAW,EAAE;AAC/C,IAAI,IAAI,YAAY;AACpB,IAAI,IAAI,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,EAAE;AAC/D,MAAM,YAAY,GAAG,qCAAqC;AAC1D,KAAK,MAAM,IAAI,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE;AACnG,MAAM,YAAY,GAAG,oBAAoB;AACzC,KAAK,MAAM;AACX,MAAM,YAAY,GAAG,uBAAuB;AAC5C;AACA,IAAI,OAAO,IAAI,QAAQ,CAAC,MAAM,EAAE;AAChC,MAAM,OAAO,EAAE;AACf,QAAQ,cAAc,EAAE,WAAW;AACnC,QAAQ,eAAe,EAAE,YAAY;AACrC,QAAQ,6BAA6B,EAAE,GAAG;AAC1C,QAAQ,8BAA8B,EAAE,KAAK;AAC7C,QAAQ,8BAA8B,EAAE;AACxC;AACA,KAAK,CAAC;AACN,GAAG,CAAC,OAAO,CAAC,EAAE;AACd,IAAI,OAAO,CAAC,KAAK,CAAC,cAAc,EAAE,CAAC,CAAC;AACpC,IAAI,MAAM,KAAK,CAAC,GAAG,EAAE,4BAA4B,CAAC;AAClD;AACA;;;;"}